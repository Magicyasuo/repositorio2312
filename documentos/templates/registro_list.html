{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Tabla de Registros</title>
    <meta name="description" content="Gestión de registros documentales con exportación y edición dinámica.">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <!-- Animate.css -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Tu CSS personalizado -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
<main>
    
    <!-- NAV -->
    <nav class="navbar navbar-light bg-light mb-4 animate__animated animate__fadeInDown animate__delay-1s">
      <div class="container-fluid">
          <a class="navbar-brand d-flex align-items-center" href="/">
              <i class="bi bi-archive-fill text-primary me-2" style="font-size:1.5rem;"></i>
              Hospital del Sarare
          </a>
          <span class="navbar-text">
              {% if request.user.is_authenticated %}
                  Bienvenido, {{ request.user.username }} | <a href="{% url 'logout' %}">Cerrar sesión</a>
              {% else %}
                  <a href="{% url 'login' %}">Iniciar sesión</a>
              {% endif %}
          </span>
      </div>
  </nav>

    <!-- CONTENIDO -->
    <div class="container-fluid mt-5">
        <!-- Encabezado -->
        <div class="d-flex justify-content-between align-items-center mb-3 animate__animated animate__fadeInDown">
            <!-- Título alineado a la izquierda con animación -->
            <h1 class="text-primary animate__animated animate__fadeInUp" id="pageTitle">Lista de Registros</h1>
            <!-- Botones alineados a la derecha con animaciones -->
            <div class="d-flex gap-2">
                <a href="{% url 'crear_registro' %}" class="btn btn-success animate__animated animate__zoomIn">
                    <i class="bi bi-file-earmark-plus"></i> Crear Nuevo Registro
                </a>
                <a href="{% url 'lista_completa_registros' %}" class="btn btn-info animate__animated animate__zoomIn animate__delay-1s">
                    <i class="bi bi-table"></i> Ver Tabla Completa
                </a>
            </div>
        </div>

        <!-- Tabla centrada -->
        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-center">
                    <table id="tablaRegistros" class="table table-striped table-bordered tabla-ancha">
                        <thead>
                            <tr>
                                <th>N° Orden</th>
                                <th>Código</th>
                                <th>Código Serie</th>
                                <th>Código Subserie</th>
                                <th>Unidad Documental</th>
                                <th>Fecha de Archivo</th>
                                <th>Físico</th>
                                <th>Electrónico</th>
                                <th>Creado Por</th> 
                                <th>Acciones</th>
                            </tr>
                            <tr>
                                <!-- Campos de búsqueda por columna -->
                                <th><input type="text" placeholder="Buscar N° Orden" /></th>
                                <th><input type="text" placeholder="Buscar Código" /></th>
                                <th><input type="text" placeholder="Buscar Código Serie" /></th>
                                <th><input type="text" placeholder="Buscar Código Subserie" /></th>
                                <th><input type="text" placeholder="Buscar Unidad Documental" /></th>
                                <th><input type="text" placeholder="Buscar Fecha Archivo" /></th>
                                <th><input type="text" placeholder="Buscar Físico" /></th>
                                <th><input type="text" placeholder="Buscar Electrónico" /></th>
                                <th><input type="text" placeholder="Buscar Creado Por" /></th>
                                <th></th> <!-- Sin filtro para Acciones -->
                            </tr>
                        </thead>
                        <tbody>
                            {% for registro in registros %}
                            <tr class="animate__animated animate__fadeIn">
                                <td>{{ registro.numero_orden }}</td>
                                <td>{{ registro.codigo }}</td>
                                <td>{{ registro.codigo_serie }}</td>
                                <td>{{ registro.codigo_subserie }}</td>
                                <td>{{ registro.unidad_documental }}</td>
                                <td>{{ registro.fecha_archivo }}</td>
                                <td class="text-center">{% if registro.soporte_fisico %}✔{% else %}✖{% endif %}</td>
                                <td class="text-center">{% if registro.soporte_electronico %}✔{% else %}✖{% endif %}</td>
                                <td>{{ registro.creado_por }}</td>
                                <td>
                                    <a href="{% url 'editar_registro' registro.id %}" class="btn btn-warning btn-sm"><i class="bi bi-pencil"></i> Editar</a>
                                    <a href="{% url 'eliminar_registro' registro.id %}" class="btn btn-danger btn-sm"><i class="bi bi-trash"></i> Eliminar</a>
                                </td>
                            </tr>
                            {% empty %}
                            <tr class="animate__animated animate__fadeIn">
                                <td colspan="10" class="text-center">No hay registros disponibles.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
  </main>
    <footer>
      <p>&copy; {{ current_year }} Hospital del Sarare - Central de Archivos del Sarare.</p>
  </footer>
    
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
    // Selecciona la segunda fila de <thead> (donde están los inputs) y a cada <th> le añadimos un listener:
$('#tablaRegistros thead tr:eq(1) th').each(function (i) {
  // Ignora la columna Acciones si no tiene input
  const input = $(this).find('input');
  if (input.length) {
    // Cuando el usuario teclea en el input, dispara la búsqueda en la columna i
    input.on('keyup change', function () {
      if ($('#tablaRegistros').DataTable().column(i).search() !== this.value) {
        $('#tablaRegistros').DataTable().column(i).search(this.value).draw();
      }
    });
  }
});

$('#tablaRegistros').DataTable({
  serverSide: true,
  processing: true,
  orderCellsTop: true,
  ajax: {
      url: "{% url 'registros_api' %}",
      type: "GET",
  },
  columns: [
  { data: 'numero_orden' },
  { data: 'codigo' },
  { data: 'codigo_serie' },
  { data: 'codigo_subserie' },
  { data: 'unidad_documental' },
  { data: 'fecha_archivo' },
  {
    data: 'soporte_fisico',
    render: function(data) {
      return data ? '✔' : '✖';
    }
  },
  {
    data: 'soporte_electronico',
    render: function(data) {
      return data ? '✔' : '✖';
    }
  },
  { data: 'creado_por' },
  {
    data: null,
    orderable: false,
    searchable: false,
    render: function(data, type, row) {
      return `
        <a href="/editar_registro/${row.id}/" class="btn btn-warning btn-sm">
          <i class="bi bi-pencil"></i> Editar
        </a>
        <a href="/eliminar_registro/${row.id}/" class="btn btn-danger btn-sm">
          <i class="bi bi-trash"></i> Eliminar
        </a>
      `;
    }
  }
],

  language: {
    // tu configuración de idioma...
  },
  pageLength: 50,
});
</script>
    
</body>
</html>


<!-- #superprueba 12345 -->
<!-- python manage.py createsuperuser Eliana Archivo 123123-->
 <!-- eliana Jeanclaude12345 -->
    